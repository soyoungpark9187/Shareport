<!DOCTYPE HTML>
<!--
	Future Imperfect by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
  <title>Single - Future Imperfect by HTML5 UP</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="assets/css/main.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body class="single is-preload">

  <!-- Wrapper -->
  <div id="wrapper">

    <!-- Header -->
    <header id="header">
      <h1><a href="index.html">Future Imperfect</a></h1>
      <nav class="links">
        <ul>
          <li><a href="#">Home</a></li>
          <li><a href="#">My Page</a></li>
          <li><a id="joinmenu" href="#">Join</a></li>
          <li><a id="loginmenu" href="login.html">Log In</a></li>
          <li><a href="#">Adipiscing</a></li>
        </ul>
      </nav>
      <nav class="main">
        <ul>
          <li class="search">
            <a class="fa-search" href="#search">Search</a>
            <form id="search" method="get" action="#">
              <input type="text" name="query" placeholder="Search" />
            </form>
          </li>
          <li class="menu">
            <a class="fa-bars" href="#menu">Menu</a>
          </li>
        </ul>
      </nav>
    </header>

    <!-- Menu -->
    <section id="menu">

      <!-- Search -->
      <section>
        <form class="search" method="get" action="#">
          <input type="text" name="query" placeholder="Search" />
        </form>
      </section>

      <!-- Links -->
      <section>
        <ul class="links">
          <li>
            <a href="#">
              <h3>Lorem ipsum</h3>
              <p>Feugiat tempus veroeros dolor</p>
            </a>
          </li>
          <li>
            <a href="#">
              <h3>Dolor sit amet</h3>
              <p>Sed vitae justo condimentum</p>
            </a>
          </li>
          <li>
            <a href="#">
              <h3>Feugiat veroeros</h3>
              <p>Phasellus sed ultricies mi congue</p>
            </a>
          </li>
          <li>
            <a href="#">
              <h3>Etiam sed consequat</h3>
              <p>Porta lectus amet ultricies</p>
            </a>
          </li>
        </ul>
      </section>

      <!-- Actions -->
      <section>
        <ul class="actions stacked">
          <li><a href="#" class="button large fit">Log In</a></li>
        </ul>
      </section>

    </section>

    <!-- Main -->
    <div id="main">

      <!-- Post -->
      <article class="post">
        <header>
          <div class="title">
            <h2><a href="#">Shareport에 오신것을 환영합니다!</a></h2>
            <p>Lorem ipsum dolor amet nullam consequat etiam feugiat</p>
          </div>
          <div class="meta">
            <time class="published" datetime="2015-11-01">November 1, 2015</time>
            <a href="#" class="author"><span class="name">Jane Doe</span><img src="images/avatar.jpg" alt="" /></a>
          </div>
        </header>

        <div class="form-group">
        <label for="email">Email address:</label>
        <input type="email" class="form-control" id="email">
      </div>
      <br>
      <div class="form-group">
        <label for="name">NicName:</label>
        <input type="text" class="form-control" id="name">
      </div>
      <br>
      <div class="form-group">
        <label for="pwd">Password:</label>
        <input type="password" class="form-control" id="pwd">
      </div>
      <br>
      <button type="button" class="btn btn-default join">가입</button>

        <br>
        <br>
      </article>

    </div>



    <!-- Footer -->
    <section id="footer">
      <ul class="icons">
        <li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
        <li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
        <li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
        <li><a href="#" class="icon solid fa-rss"><span class="label">RSS</span></a></li>
        <li><a href="#" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
      </ul>
      <p class="copyright">&copy; Untitled. Design: <a href="http://html5up.net">HTML5 UP</a>. Images: <a href="http://unsplash.com">Unsplash</a>.</p>
    </section>

  </div>

  <!-- Scripts -->
  <script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>
  <script>
    var firebaseEmailAuth; //파이어베이스 email 인증 모듈 전역변수
    var firebaseDatabase; //파이어베이스 db 모듈 전역변수
    var userInfo; //가입한 유저의 정보. object 타입
    //파이어 베이스 초기화 코드
    var config = {
      apiKey: "AIzaSyBealjJBHfcbRlptxLcAoxdhpSbFswQOZg",
      authDomain: "shareport-e85b2.firebaseapp.com",
      databaseURL: "https://shareport-e85b2.firebaseio.com",
      projectId: "shareport-e85b2",
      storageBucket: "shareport-e85b2.appspot.com",
      messagingSenderId: "978150427508",
      appId: "1:978150427508:web:115635132ce73e50223a21",
      measurementId: "G-1SB8TYEZ99"
    };
    firebase.initializeApp(config);

    firebaseEmailAuth = firebase.auth();
    firebaseDatabase = firebase.database();


    //제이쿼리
    $(document).ready(function() {

      //가입버튼 눌렀을 때 작동하는 함수
      $(document).on('click', '.join', function() {

        //jquery를 이용해서 입력된 값을 가져온다.
        var email = $('#email').val();
        var password = $('#pwd').val();
        name = $('#name').val();

        //이메일로 가입 버튼 눌렀을 때 작동되는 함수 - firebase 인증 모듈
        firebaseEmailAuth.createUserWithEmailAndPassword(email, password).then(function(user) {

          userInfo = user; //가입 후 callBack 함수로 생성된 유저의 정보가 user에 담겨서 넘어온다. 전역변수에 할당.

          //뭐가 찍히는지 직접 체크해보세요.
          console.log("userInfo/" + userInfo); //오브젝트 타입
          console.log("userInfo.currentUser/" + userInfo.currentUser); //안됨
          console.log("userInfo.uid/" + userInfo.uid); //vPArtCHqPpOeIOpidEfug0Kgq3v1

          //성공했을 때 작동되는 함수
          logUser();

        }, function(error) {
          //에러가 발생했을 때
          var errorCode = error.code;
          var errorMessage = error.message;
          alert(errorMessage);
        });

        //가입 성공했을 때 호출 되는 함수 - 위의 firebase의 인증 모듈과 다른 database 모듈임을 확인하자.
        function logUser() {
          var ref = firebaseDatabase.ref("users/" + userInfo.uid); //저장될 곳을 users라는 부모 키를 레퍼런스로 지정.

          //저장 형식
          //++key 값도 같이 넣어준다.
          var obj = {
            name: name,
            userkey: userInfo.uid
          };

          ref.set(obj); // 고유한 자식 키가 하나 생셩이 되면서 json 삽입
          alert("가입성공");

          //메인 페이지로 이동시키고 세션 저장시키기
          window.location.href = "/index.html"
        }


      });
    });
  </script>
  <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/browser.min.js"></script>
  <script src="assets/js/breakpoints.min.js"></script>
  <script src="assets/js/util.js"></script>
  <script src="assets/js/main.js"></script>

</body>

</html>
