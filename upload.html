<!DOCTYPE HTML>
<!--
	Future Imperfect by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
  <title id="titleCheck">SHAREPORT</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="assets/css/main.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body class="single is-preload">

  <!-- Wrapper -->
  <div id="wrapper">

    <!-- Header -->
    <header id="header">
      <h1><a href="index.html">SHARE:PORT</a></h1>
      <nav class="links">
        <ul>
          <li><a href="#">Home</a></li>
          <li><a href="#">My Page</a></li>
          <li><a id="joinmenu" href="#">Join</a></li>
          <li><a id="loginmenu" href="login.html">Log In</a></li>

        </ul>
      </nav>
      <nav class="main">
        <ul>
          <li class="search">
            <a class="fa-search" href="#search">Search</a>
            <form id="search" method="get" action="#">
              <input type="text" name="query" placeholder="Search" />
            </form>
          </li>
          <li class="menu">
            <a class="fa-bars" href="#menu">Menu</a>
          </li>
        </ul>
      </nav>
    </header>

    <!-- Menu -->
    <section id="menu">

      <!-- Search -->
      <section>
        <form class="search" method="get" action="#">
          <input type="text" name="query" placeholder="Search" />
        </form>
      </section>

      <!-- Links -->
        <section>
          <ul class="links">
            <li>
              <a href="#">
                <h3>Home</h3>
                <p>홈화면으로 돌아가기</p>
              </a>
            </li>
            <li>
              <a href="#">
                <h3>My Page</h3>
                <p>마이페이지로 가기</p>
              </a>
            </li>
            <li>
              <a href="upload.html">
                <h3>Upload</h3>
                <p>레포트 업로드 하가</p>
              </a>
            </li>
            <li>
              <a href="#">
                <h3>Customer Service</h3>
                <p>고객센터</p>
              </a>
            </li>
          </ul>
        </section>


      <!-- Actions -->
      <section>
        <ul class="actions stacked">
          <li><a href="#" class="button large fit">Log In</a></li>
        </ul>
      </section>

    </section>

    <!-- Main -->
    <div id="main">

      <!-- Post -->
			<article class="post">
				<header>
          <div class="title">
            <h2><a href="#">레포트를 업로드 해주세요.</a></h2>
            <p>Upload Report</p>
          </div>
          <div class="meta">
            <time class="published" datetime="2019-12-14">December 14, 2019</time>
            <a href="#" class="author"><span class="name">HALIM</span><img src="images/avatar.jpg" alt="" /></a>
          </div>
        </header>
			<br>
			<br>
			<input type="file" value="upload" id="fileButton"/>
			<input type="file" value="upload" id="seg1Button"/>
			<input type="file" value="upload" id="seg2Button"/>
			<input type="file" value="upload" id="seg3Button"/>
			<br>
			<br>
			<br>

			<progress value = "0" max="100" id="uploader">0%</progress>
			<br>
			<button type="button" id="uploadButton">upload</button>

		</article>
    </div>



    <!-- Footer -->
    <section id="footer">
      <ul class="icons">
        <li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
        <li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
        <li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
        <li><a href="#" class="icon solid fa-rss"><span class="label">RSS</span></a></li>
        <li><a href="#" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
      </ul>
      <p class="copyright">&copy; Untitled. Design: <a href="http://html5up.net">HTML5 UP</a>. Images: <a href="http://unsplash.com">Unsplash</a>.</p>
    </section>

  </div>

  <!-- Scripts -->
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/browser.min.js"></script>
	<script src="assets/js/breakpoints.min.js"></script>
	<script src="assets/js/util.js"></script>
	<script src="assets/js/main.js"></script>
	<script src="./js/time.js"></script>
	<script src="./js/sessionCheck.js"></script>

	<script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.3.0/firebase-analytics.js"></script>
  <script>
    var firebaseEmailAuth; //파이어베이스 email 인증 모듈 전역변수
    var firebaseDatabase; //파이어베이스 db 모듈 전역변수
    var userInfo; //가입한 유저의 정보. object 타입
		var name;
		var loginUserKey;
		var comment;
    //파이어 베이스 초기화 코드
    var config = {
      apiKey: "AIzaSyBealjJBHfcbRlptxLcAoxdhpSbFswQOZg",
      authDomain: "shareport-e85b2.firebaseapp.com",
      databaseURL: "https://shareport-e85b2.firebaseio.com",
      projectId: "shareport-e85b2",
      storageBucket: "shareport-e85b2.appspot.com",
      messagingSenderId: "978150427508",
      appId: "1:978150427508:web:115635132ce73e50223a21",
      measurementId: "G-1SB8TYEZ99"
    };

		var defaultProject = firebase.initializeApp(config);
		firebaseEmailAuth = firebase.auth(); //파이어베이스 인증 객체
		firebaseDatabase = firebase.database(); //파이어베이스 데이터베이스 객체

		userSessionCheck();


		firebase.analytics();
    //추가
  var database = firebase.database();

  //추가
  //확장자 뺀 파일이름
  var name;
  var name1;
  var name2;
  var name3;
	var uploader= document.getElementById('uploader');
  var fileButton = document.getElementById('fileButton');
  var uploadButton = document.getElementById('uploadButton');
  var seg1Button = document.getElementById('seg1Button');
  var file;
  var file_s1;
  var file_s2;
  var file_s3;
  // TODO: 여기를 유저 이름으로 바꿔주세요
  // var user_name= loginUserkey;
  var storageRef;
  var task;
  var storageRef_s1;
  var task_s1;
  var storageRef_s2;
  var task_s2;
  var storageRef_s3;
  var task_s3;






	fileButton.addEventListener('change', function(e) {
	//get file
	file = e.target.files[0];
  // 추가
    var arr = file.name.split(".");
    // 파일이름을 확장자명없이 저장
    name = arr[0];
	// create a storage ref
	storageRef =  firebase.storage().ref(loginUserKey+file.name+"/"+"main/"+file.name);
	//storageRef = firebase.storage().ref(loginUserKey);

	});
seg1Button.addEventListener('change', function(e) {
		 //get file
		 file_s1 = e.target.files[0];
     arr = file_s1.name.split(".");
       // 파일이름을 확장자명없이 저장
       name1 = arr[0];
       // 여기까지
		 // create a storage ref
		 storageRef_s1 =  firebase.storage().ref(loginUserKey+file.name+"/"+'seg1');

		 });
seg2Button.addEventListener('change', function(e) {
		 //get file
		 file_s2 = e.target.files[0];
     // 추가
       arr = file_s2.name.split(".");
       // 파일이름을 확장자명없이 저장
       name2 = arr[0];
       // 여기까지
		 // create a storage ref
		 storageRef_s2 =  firebase.storage().ref(loginUserKey+file.name+"/"+'seg2');

		 });
seg3Button.addEventListener('change', function(e) {
		 //get file
		 file_s3 = e.target.files[0];
     // 추가
       arr = file_s3.name.split(".");
       // 파일이름을 확장자명없이 저장
       name3 = arr[0];
       // 여기까지
		 // create a storage ref
		 storageRef_s3 =  firebase.storage().ref(loginUserKey+file.name+"/"+'seg3');

		 });
uploadButton.addEventListener('click', function(){
 // upload file
		 task = storageRef.put(file);
		 task = storageRef_s1.put(file_s1);
		 task = storageRef_s2.put(file_s2);
		 task = storageRef_s3.put(file_s3);

				// update progress bar
		task.on('state_changed',

					function progress(snapshot) {
					var percentage =(snapshot.bytesTransferred / snapshot.totalBytes) * 100;
					uploader.value = percentage;
					},

						 function error(err) {

						},

					 // finished uploading
						 function complete() {

						 }

		 );
     console.log('full', file.name);
       console.log('name',name);
       // 추가
       database.ref('report/'+name+'/segement').set({
          seg1:name1,
          seg2:name2,
          seg3:name3,
          key:loginUserKey
       });
      // 여기까지
	 });

  </script>

</body>

</html>
